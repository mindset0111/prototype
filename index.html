<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXT Customer Support - Submit Enquiry Prototype (Advanced)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #004d40; /* Dark Teal/Green - NEXT brand hint */
            margin-bottom: 5px;
        }
        p.intro {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 25px;
        }
        .section-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #004d40;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        textarea,
        select {
            width: calc(100% - 22px); /* Account for padding and border */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box; /* Include padding in width */
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        .conditional-field {
            display: none; /* Hidden by default, shown via JS/mockup logic */
            background-color: #f0fafa; /* Light blue-green for emphasis */
            padding: 15px;
            border-left: 4px solid #004d40;
            margin-top: 15px;
            border-radius: 4px;
        }
        .order-status-box, .info-box {
            background-color: #e6f7ff; /* Light blue */
            border: 1px solid #b3e0ff;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .order-status-box p, .info-box p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        .order-status-box strong, .info-box strong {
            color: #004d40;
        }
        .button {
            background-color: #28a745; /* NEXT Green */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 20px;
        }
        .button:hover {
            background-color: #218838;
        }
        .action-button {
            background-color: #007bff; /* Blue for action */
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.9em;
        }
        .action-button:hover {
            background-color: #0056b3;
        }
        .checkbox-group label {
            display: inline;
            font-weight: normal;
        }
        .required-field::after {
            content: ' *';
            color: red;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more specific */
            max-width: 500px;
            border-radius: 8px;
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .contact-details-readonly input {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        /* NEW STYLE FOR SPACING */
        .customer-details-intro {
            font-size: 0.85em;
            color: #777;
            margin-top: 5px; /* Added space above */
            margin-bottom: 15px; /* Added space below */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NEXT Customer Support: Submit an Enquiry</h1>
        <p class="intro">We're here to help! To get your query resolved as quickly as possible, please provide the details below.</p>

        <div class="section-header">Section 1: Your Enquiry Details</div>
        <div class="form-group">
            <label for="enquiryCategory" class="required-field">1. What is your enquiry about?</label>
            <select id="enquiryCategory" onchange="showHideSubCategory()">
                <option value="">Please Select</option>
                <option value="orderDelivery">Order & Delivery Issues</option>
                <option value="accountManagement">Account Management</option>
                <option value="returnsRefunds">Returns & Refunds</option>
                <option value="productInfo">Product Information/Queries</option>
                <option value="websiteTech">Website/App Technical Issues</option>
                <option value="paymentBilling">Payment & Billing Queries</option>
                <option value="storeRelated">Store-Related Queries</option>
                <option value="other">Other</option>
            </select>
        </div>

        <div class="form-group" id="subCategoryGroup" style="display:none;">
            <label for="enquirySpecific" class="required-field">2. Please provide more specific details about your issue:</label>
            <select id="enquirySpecific" onchange="showHideConditionalFields()">
                </select>
        </div>

        <div class="section-header">Section 2: Your Account & Order Information</div>

        <div class="form-group" id="accountLoginSection">
            <label for="emailAddress">3. Email Address / Account Login:</label>
            <p id="loggedInStatus" style="display:none;">Logged in as: <strong>simulated.customer@next.co.uk</strong> <button class="action-button" onclick="logOut()">Change Account</button></p>
            <div id="guestLogin" style="display:block;">
                <input type="email" id="emailAddress" placeholder="your.email@example.com">
                <button class="action-button" onclick="simulateLogin()">Log In to your NEXT Account</button>
                <button class="action-button" onclick="continueAsGuest()">Continue as Guest</button>
            </div>
        </div>

        <div class="form-group" id="customerDetailsSection" style="display:none;">
            <label>4. Customer Details:</label>
            <p class="customer-details-intro">We'll try to fetch these from your account. Please confirm or update if needed.</p>
            <div class="checkbox-group">
                <input type="checkbox" id="fetchAccountDetails" checked onchange="toggleContactEdit()">
                <label for="fetchAccountDetails">Fetch my personal details from my account</label>
            </div>

            <div id="contactFields">
                <div class="form-group">
                    <label for="fullName">Full Name:</label>
                    <input type="text" id="fullName" placeholder="Your Full Name">
                </div>
                <div class="form-group">
                    <label for="postcode">Postcode (for account verification):</label>
                    <input type="text" id="postcode" placeholder="e.g., SW1A 0AA">
                </div>
                <div class="form-group">
                    <label for="telephoneNumber">Best Contact Telephone Number (Optional):</label>
                    <input type="tel" id="telephoneNumber" placeholder="e.g., 07912 345678">
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="orderNumber" id="orderNumberLabel">5. Order Number:</label>
            <p style="font-size: 0.85em; color: #777; margin-top: -10px; margin-bottom: 10px;">Required for all Order & Delivery and Returns queries.</p>
            <input type="text" id="orderNumber" placeholder="e.g., 123456789">
            <button class="action-button" onclick="lookupOrder()">Lookup Order Status</button>
            <button class="action-button" onclick="viewLastOrders()">View My Last 3 Orders</button>
            <div id="orderStatusDisplay" class="order-status-box" style="display:none;">
                </div>
        </div>
        <div class="form-group">
            <label for="orderDate">6. When was the order placed? (Optional)</label>
            <input type="date" id="orderDate">
        </div>

        <div class="form-group">
            <label>7. Last Payment Status:</label>
            <p style="font-size: 0.85em; color: #777; margin-top: -10px; margin-bottom: 10px;">Check the status of your most recent payment to confirm if it was successful.</p>
            <button class="action-button" onclick="checkLastPayment()">Check Last Payment Status</button>
            <div id="lastPaymentDisplay" class="info-box" style="display:none;">
                </div>
        </div>


        <div class="section-header">Section 3: Describe Your Issue</div>
        <div class="form-group">
            <label for="issueSubject" class="required-field">8. Subject/Brief Summary of Issue:</label>
            <input type="text" id="issueSubject" placeholder="e.g., Missing item from order #123456789">
        </div>
        <div class="form-group">
            <label for="issueDetails" class="required-field">9. Please describe your issue in detail:</label>
            <textarea id="issueDetails" placeholder="Please include any relevant dates, times, specific item numbers, sizes, colours, product names, or tracking numbers to help us investigate. For faulty items, describe the fault."></textarea>
        </div>

        <div class="conditional-field" id="itemsNotReceivedFields">
            <div class="form-group">
                <label for="specificItems">10. Specific Item(s) Not Received (Item Number, Name, Size, Colour):</label>
                <textarea id="specificItems" placeholder="e.g., Item 123-456 - Blue Dress, Size 10"></textarea>
            </div>
            <div class="form-group">
                <label>11. Reorder Required?</label>
                <input type="radio" id="reorderYes" name="reorder" value="Yes"> <label for="reorderYes" class="checkbox-group">Yes</label><br>
                <input type="radio" id="reorderNo" name="reorder" value="No"> <label for="reorderNo" class="checkbox-group">No</label><br>
                <input type="radio" id="reorderDiscuss" name="reorder" value="Discuss Options"> <label for="reorderDiscuss" class="checkbox-group">Discuss Options</label>
            </div>
        </div>

        <div class="conditional-field" id="damagedFaultyFields">
            <div class="form-group">
                <label for="affectedItems">Specific Item(s) Affected (Item Number, Name, Size, Colour):</label>
                <textarea id="affectedItems" placeholder="e.g., Item 789-012 - Next Home Sofa"></textarea>
            </div>
            <div class="form-group">
                <label for="damageDescription">Please describe the damage/fault/incorrect item:</label>
                <textarea id="damageDescription"></textarea>
            </div>
        </div>
        <div class="section-header">Section 4: Supporting Documents (Optional)</div>
        <div class="form-group">
            <label for="fileUpload">12. Attach files:</label>
            <input type="file" id="fileUpload" multiple>
            <p style="font-size: 0.85em; color: #777;">(e.g., photos of damaged items, screenshots of errors. Max file size 5MB per file, accepted formats: JPG, PNG, PDF)</p>
        </div>

        <div class="section-header">Section 5: Terms & Privacy</div>
        <div class="form-group checkbox-group">
            <input type="checkbox" id="privacyAgree" required>
            <label for="privacyAgree">I have read and agree to the <a href="#" style="color: #004d40;">Privacy Policy</a>.</label>
            <p style="font-size: 0.8em; color: #777; margin-top: 5px;">By submitting this form, you agree to our Privacy Policy and allow NEXT to use the provided information to resolve your enquiry. Your data will be handled in accordance with GDPR regulations.</p>
        </div>

        <button type="submit" class="button" onclick="validateAndSubmit(event)">Submit Enquiry</button>

    </div>

    <div id="lastOrdersModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('lastOrdersModal')">&times;</span>
            <h2>Your Last 3 Orders</h2>
            <div id="lastOrdersContent">
                <p><strong>Order #123456789</strong> (Placed: 2025-06-20) - Status: Delivered</p>
                <ul><li>Blue Dress, Red T-shirt</li></ul>
                <p><strong>Order #987654321</strong> (Placed: 2025-06-15) - Status: Partially Delivered</p>
                <ul><li>Next Home Lamp, Coffee Table (Outstanding)</li></ul>
                <p><strong>Order #112233445</strong> (Placed: 2025-06-10) - Status: Cancelled</p>
                <ul><li>Winter Coat</li></ul>
            </div>
            <p style="font-size:0.8em; color:#666; margin-top:15px;">Please use the relevant Order Number in the form above if your query relates to one of these.</p>
        </div>
    </div>

    <div id="lastPaymentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('lastPaymentModal')">&times;</span>
            <h2>Last Payment Status</h2>
            <div id="lastPaymentModalContent">
                <p><strong>Date:</strong> 2025-06-25</p>
                <p><strong>Amount:</strong> £59.99</p>
                <p><strong>Status:</strong> <strong style="color: green;">Successful</strong></p>
                <p><strong>Related Order:</strong> #123456789</p>
                <p style="font-size:0.8em; color:#666; margin-top:15px;">If this status is not what you expect, please proceed with your enquiry.</p>
            </div>
        </div>
    </div>


    <script>
        // --- PROTOTYPE JAVASCRIPT FOR DYNAMIC BEHAVIOR ---

        // Element references
        const enquiryCategory = document.getElementById('enquiryCategory');
        const subCategoryGroup = document.getElementById('subCategoryGroup');
        const enquirySpecific = document.getElementById('enquirySpecific');

        const orderNumberInput = document.getElementById('orderNumber');
        const orderNumberLabel = document.getElementById('orderNumberLabel');
        const orderStatusDisplay = document.getElementById('orderStatusDisplay');

        const itemsNotReceivedFields = document.getElementById('itemsNotReceivedFields');
        const damagedFaultyFields = document.getElementById('damagedFaultyFields');

        const accountLoginSection = document.getElementById('accountLoginSection');
        const loggedInStatus = document.getElementById('loggedInStatus');
        const guestLogin = document.getElementById('guestLogin');
        const customerDetailsSection = document.getElementById('customerDetailsSection');
        const fetchAccountDetailsCheckbox = document.getElementById('fetchAccountDetails');
        const contactFields = document.getElementById('contactFields');
        const fullNameInput = document.getElementById('fullName');
        const postcodeInput = document.getElementById('postcode');
        const telephoneNumberInput = document.getElementById('telephoneNumber');
        const emailAddressInput = document.getElementById('emailAddress'); // New ref

        const lastPaymentDisplay = document.getElementById('lastPaymentDisplay');

        const lastOrdersModal = document.getElementById('lastOrdersModal');
        const lastPaymentModal = document.getElementById('lastPaymentModal');

        // Simulated Data (for prototype only)
        const simulatedCustomerData = {
            email: "simulated.customer@next.co.uk",
            fullName: "A. Next Customer",
            postcode: "NG1 1DP",
            phone: "07700 900123"
        };
        let isLoggedIn = false; // Initial state

        const subCategories = {
            'orderDelivery': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'itemNotReceived', text: 'Item(s) Not Received' },
                { value: 'damagedFaulty', text: 'Damaged/Faulty Item Received' },
                { value: 'incorrectItem', text: 'Incorrect Item Received' },
                { value: 'missingPart', text: 'Missing Part of Order' },
                { value: 'deliveryDelay', text: 'Delivery Delay/Tracking Issue' },
                { value: 'deliveryChange', text: 'Delivery Instructions/Address Change' },
                { value: 'problemCollection', text: 'Problem with Collection (e.g., Parcelshop, Store)' },
                { value: 'orderCancellation', text: 'Order Cancellation Request' },
                { value: 'otherOrder', text: 'Other Order Issue' }
            ],
            'accountManagement': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'changeDetails', text: 'Change Personal Details (address, email, phone, name)' },
                { value: 'passwordReset', text: 'Password Reset/Account Access Issue' },
                { value: 'marketingPreferences', text: 'Marketing Preferences/Unsubscribe' },
                { value: 'closeAccount', text: 'Close Account' },
                { value: 'thirdPartyAuth', text: '3rd Party Authorisation Query' },
                { value: 'otherAccount', text: 'Other Account Query' }
            ],
            'returnsRefunds': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'refundNotReceived', text: 'Refund Not Received' },
                { value: 'incorrectRefund', text: 'Incorrect Refund Amount' },
                { value: 'arrangeCollection', text: 'Arrange a Return Collection' },
                { value: 'cancelCollection', text: 'Cancel a Planned Return Collection' },
                { value: 'returnPolicy', text: 'Return Policy Query' },
                { value: 'returnsNotCredited', text: 'Returns Not Credited (e.g., store, carrier)' },
                { value: 'otherReturn', text: 'Other Return/Refund Query' }
            ],
            'productInfo': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'sizingColour', text: 'Sizing/Colour Query' },
                { value: 'materialQuery', text: 'Material/Fabric Query' },
                { value: 'stockAvailability', text: 'Stock Online Availability' },
                { value: 'storeStock', text: 'Store Stock Availability' },
                { value: 'pricingMultiBuy', text: 'Pricing/Multi Buy Query' },
                { value: 'otherProduct', text: 'Other Product Information' }
            ],
            'websiteTech': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'accessingAccount', text: 'Accessing Account' },
                { value: 'accessingApp', text: 'Accessing App' },
                { value: 'accessingWebsite', text: 'Accessing Website' },
                { value: 'addToBasket', text: 'Add to Basket Issue' },
                { value: 'checkoutIssue', text: 'Checkout Issue' },
                { value: 'websiteSlow', text: 'Website Slow/Freezing' },
                { value: 'incorrectDetail', text: 'Website Has Incorrect Item Detail' },
                { value: 'otherWebsite', text: 'Other Website/App Issue' }
            ],
            'paymentBilling': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'paymentDeclined', text: 'Payment Declined' },
                { value: 'paymentMissing', text: 'Payment Missing/Not Applied' },
                { value: 'directDebitIssue', text: 'Direct Debit Issue (Setup, Cancel, Taken)' },
                { value: 'statementQuery', text: 'Statement Explanation/Incorrect Statement' },
                { value: 'chargesQuery', text: 'Charges Query (£35 Admin, Delivery, Interest)' },
                { value: 'otherPayment', text: 'Other Payment/Billing Query' }
            ],
            'storeRelated': [
                { value: '', text: 'Please Select Specific Issue' },
                { value: 'parcelCollection', text: 'Parcel Collection Issue' },
                { value: 'staffMember', text: 'Issue with a Staff Member' },
                { value: 'storeConditions', text: 'Store Conditions/Facilities' },
                { value: 'storePurchase', text: 'Store Purchase Query' },
                { value: 'otherStore', text: 'Other Store Related Query' }
            ],
            'other': [
                 { value: '', text: 'Please Describe Below' }
            ]
        };

        // --- Functions for main category and sub-category logic ---
        function showHideSubCategory() {
            const selectedCategory = enquiryCategory.value;
            enquirySpecific.innerHTML = ''; // Clear previous options
            subCategoryGroup.style.display = 'none'; // Hide by default

            if (selectedCategory && subCategories[selectedCategory]) {
                subCategories[selectedCategory].forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    enquirySpecific.appendChild(opt);
                });
                subCategoryGroup.style.display = 'block';
            }
            showHideConditionalFields(); // Update conditional fields
            toggleOrderNumberMandatory(); // Update order number requirement
        }

        function showHideConditionalFields() {
            hideAllConditionalFields(); // Hide all first
            const selectedSpecific = enquirySpecific.value;

            if (selectedSpecific === 'itemNotReceived' || selectedSpecific === 'missingPart') {
                itemsNotReceivedFields.style.display = 'block';
            } else if (selectedSpecific === 'damagedFaulty' || selectedSpecific === 'incorrectItem') {
                damagedFaultyFields.style.display = 'block';
            }
            // Add more conditions for other specific issue types
        }

        function hideAllConditionalFields() {
            itemsNotReceivedFields.style.display = 'none';
            damagedFaultyFields.style.display = 'none';
            // ... hide other conditional fields
        }

        function toggleOrderNumberMandatory() {
            const category = enquiryCategory.value;
            const isOrderRelated = ['orderDelivery', 'returnsRefunds'].includes(category);

            if (isOrderRelated) {
                orderNumberInput.setAttribute('required', 'required');
                orderNumberLabel.classList.add('required-field');
            } else {
                orderNumberInput.removeAttribute('required');
                orderNumberLabel.classList.remove('required-field');
            }
        }

        // --- Functions for Account/Personal Information ---
        function simulateLogin() {
            isLoggedIn = true;
            loggedInStatus.style.display = 'block';
            guestLogin.style.display = 'none';
            customerDetailsSection.style.display = 'block';
            fetchAccountDetailsCheckbox.checked = true;
            toggleContactEdit();
            alert("Simulated Login Successful! Your details have been pre-filled.");
        }

        function logOut() {
            isLoggedIn = false;
            loggedInStatus.style.display = 'none';
            guestLogin.style.display = 'block';
            fetchAccountDetailsCheckbox.checked = false;
            toggleContactEdit(); // Clears pre-filled if any
            // Clear email input if logging out
            emailAddressInput.value = '';
            alert("You have been logged out.");
        }

        function continueAsGuest() {
             customerDetailsSection.style.display = 'block';
             fetchAccountDetailsCheckbox.checked = false;
             toggleContactEdit();
             guestLogin.style.display = 'none';
        }

        function toggleContactEdit() {
            const shouldFetch = fetchAccountDetailsCheckbox.checked && isLoggedIn;
            const inputs = contactFields.querySelectorAll('input');

            if (shouldFetch) {
                fullNameInput.value = simulatedCustomerData.fullName;
                postcodeInput.value = simulatedCustomerData.postcode;
                telephoneNumberInput.value = simulatedCustomerData.phone;
                inputs.forEach(input => {
                    input.setAttribute('readonly', 'readonly');
                    input.classList.add('contact-details-readonly');
                });
            } else {
                // Only clear if coming from a "fetched" state and now unchecked
                if (isLoggedIn) {
                    fullNameInput.value = '';
                    postcodeInput.value = '';
                    telephoneNumberInput.value = '';
                }
                inputs.forEach(input => {
                    input.removeAttribute('readonly');
                    input.classList.remove('contact-details-readonly');
                });
            }
        }

        // --- Functions for Information Fetching ---
        function lookupOrder() {
            const orderNum = orderNumberInput.value.trim();
            if (orderNum) {
                orderStatusDisplay.innerHTML = `
                    <p><strong>Order Status for ${orderNum}:</strong></p>
                    <p>Status: <strong>Partially Delivered</strong></p>
                    <p>Expected Delivery: <strong>Items still outstanding expected by 30th June 2025</strong></p>
                    <p>Tracking: <a href="#" target="_blank" style="color: #004d40;">Track with Evri (EVRI123456789)</a></p>
                    <p><strong>Items in Order:</strong></p>
                    <ul>
                        <li>Item 987-654 - Red T-shirt, Size M: <strong style="color: green;">Delivered</strong></li>
                        <li>Item 123-456 - Blue Jeans, Size 32: <strong style="color: orange;">In Transit</strong></li>
                        <li>Item 789-012 - Next Home Lamp: <strong style="color: orange;">In Transit</strong></li>
                    </ul>
                `;
                const selectedSpecific = enquirySpecific.value;
                if (['itemNotReceived', 'missingPart'].includes(selectedSpecific)) {
                    orderStatusDisplay.innerHTML += `<p style="color: #c00; font-weight: bold; margin-top: 10px;">Our records show Item 987-654 (Red T-shirt) as 'Delivered'. If you have not received it, please proceed with your enquiry and include any delivery instructions you provided.</p>`;
                }
                orderStatusDisplay.style.display = 'block';
            } else {
                orderStatusDisplay.style.display = 'none';
                alert('Please enter an Order Number to look up its status.');
            }
        }

        function viewLastOrders() {
            openModal('lastOrdersModal');
        }

        function checkLastPayment() {
            openModal('lastPaymentModal');
        }

        // --- Modal Functions ---
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // --- Form Submission Validation (Basic) ---
        function validateAndSubmit(event) {
            const category = enquiryCategory.value;
            const specificIssue = enquirySpecific.value;
            const orderNum = orderNumberInput.value.trim();
            const issueSubject = document.getElementById('issueSubject').value.trim();
            const issueDetails = document.getElementById('issueDetails').value.trim();
            const privacyChecked = document.getElementById('privacyAgree').checked;

            if (category === '') {
                alert('Please select your enquiry category.');
                event.preventDefault(); return;
            }
            if (specificIssue === '') {
                alert('Please select more specific details about your issue.');
                event.preventDefault(); return;
            }
            if (['orderDelivery', 'returnsRefunds'].includes(category) && orderNum === '') {
                alert('Order Number is mandatory for this type of enquiry.');
                orderNumberInput.focus();
                event.preventDefault(); return;
            }
            if (issueSubject === '') {
                alert('Please provide a brief summary of your issue.');
                issueSubject.focus();
                event.preventDefault(); return;
            }
            if (issueDetails === '') {
                alert('Please describe your issue in detail.');
                issueDetails.focus();
                event.preventDefault(); return;
            }
            if (!privacyChecked) {
                alert('You must agree to the Privacy Policy to submit your enquiry.');
                event.preventDefault(); return;
            }

            alert('Form submitted successfully (simulated)! Thank you for your enquiry. We will be in touch shortly.');
            event.preventDefault();
        }

        // --- Initial setup on page load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial state to logged out and fields editable
            // This ensures customerDetailsSection is visible for guest input
            isLoggedIn = false; // Ensure this is false initially
            loggedInStatus.style.display = 'none';
            guestLogin.style.display = 'block';
            customerDetailsSection.style.display = 'block'; // Always show customer details section initially
            fetchAccountDetailsCheckbox.checked = false; // Ensure it's unchecked for guest
            toggleContactEdit(); // Set fields to editable

            emailAddressInput.value = ''; // Ensure email is blank on load
            toggleOrderNumberMandatory(); // Set initial order number requirement
            showHideSubCategory(); // Initialize sub-category dropdown
        });

    </script>
</body>
</html>